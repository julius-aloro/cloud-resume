stages:
  - plan
  - apply
  - file_upload
  - invalidation
  - testing

variables:
  AWS_DEFAULT_REGION: "ap-southeast-1"
  base_url: juliusaloro.into-cloud.com
  planfile: plan.tfplan

terraform_version_check:
  image:
    name: registry.gitlab.com/julius.aloro/my-cloud-resume/terraform:1.10
    entrypoint: [""]
  stage: plan
  script:
    - terraform version


terraform_plan:
  dependencies:
    - terraform_version_check
  image:
    name: registry.gitlab.com/julius.aloro/my-cloud-resume/terraform:1.10
    entrypoint: [""]
  stage: plan
  script:
    - cd infra/
    - mkdir plans
    - terraform init
    - terraform plan -out=plans/$planfile
    - terraform show plans/$planfile
  artifacts:
    paths:
      - plans/$planfile
    untracked: false
    when: on_success
    access: all
    expire_in: "30 days"
  